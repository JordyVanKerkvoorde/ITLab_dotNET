@model ITLab29.Models.ViewModels.FeedBackViewModel;
@using Microsoft.AspNetCore.Identity
@using ITLab29.Models.Domain;
@using ITLab29.Models.ViewModels;
@using System.Collections;

@{
    ViewData["Title"] = "Details";
}

@{
    User user = ViewData["user"] as User;
    Session session = ViewData["session"] as Session;
    IList<Media> images = ViewData["images"] as List<Media>;
    IList<Media> files = ViewData["files"] as List<Media>;
    bool isAuth = User.Identity.IsAuthenticated;
}

<div class="h-25 row">
    <div class="col-md-5">
        <img class="img-fluid"
             src="https://i1.wp.com/guide-high-tech.com/wp-content/uploads/2019/04/Cloud-Computing-01.jpg?fit=1000%2C680&ssl=1"
             alt="Alternate Text" />
    </div>
    <div class="col-md-7 my-auto">
        <div class="page-header">
            <h1>
                @session.Title
            </h1>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-sm-7">
        <dl>
            <dt>
                Omschrijving
            </dt>
            <dd>
                @session.Description
            </dd>
        </dl>
        <!-- begin section media -->
        <ul class="nav nav-tabs nav-justified" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="images-tab" data-toggle="tab" href="#images" role="tab" aria-controls="home"
                   aria-selected="true">Images</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="videos-tab" data-toggle="tab" href="#videos" role="tab" aria-controls="profile"
                   aria-selected="false">Videos</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="files-tab" data-toggle="tab" href="#files" role="tab" aria-controls="contact"
                   aria-selected="false">Files</a>
            </li>
        </ul>
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="images" role="tabpanel" aria-labelledby="images-tab">
                <!--Carousel Wrapper-->
                <div id="carousel-example-1z" class="carousel slide carousel-fade p-1" data-ride="carousel">
                    <!--Indicators-->
                    <ol class="carousel-indicators">
                        @{
                            if (images.Count() == 0)
                            {
                                <li data-target="#carousel-example-1z" data-slide-to="0" class="active"></li>
                            }
                            else
                            {
                                <li data-target="#carousel-example-1z" data-slide-to="0" class="active"></li>
                                for (int i = 1; i < images.Count(); i++)
                                {
                                    <li data-target="#carousel-example-1z" data-slide-to="@i"></li>
                                }
                            }
                        }
                    </ol>
                    <!--/.Indicators-->
                    <!--Slides-->
                    <div class="carousel-inner" role="listbox">
                        @{

                            if (images.Count() > 0)
                            {
                                <div class="carousel-item active">
                                    <img class="d-block w-100 h-50" src=@images[0].Path
                                         alt="First slide">
                                </div>
                                for (int i = 1; i < images.Count(); i++)
                                {
                                    <div class="carousel-item">
                                        <img class="d-block w-100 h-50" src=@images[i].Path
                                             alt="First slide">
                                    </div>
                                }
                            }
                            else
                            {
                                <div class="carousel-item active">
                                    <img class="d-block w-100 h-50" src="https://upload.wikimedia.org/wikipedia/commons/0/05/No_image_available_600_x_200.svg"
                                         alt="First slide">
                                </div>
                            }
                        }
                    </div>
                    <!--/.Slides-->
                    <!--Controls-->
                    <a class="carousel-control-prev" href="#carousel-example-1z" role="button" data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carousel-example-1z" role="button" data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                    <!--/.Controls-->
                </div>
                <!--/.Carousel Wrapper-->
            </div>
            <div class="tab-pane fade" id="videos" role="tabpanel" aria-labelledby="videos-tab">
                Food truck fixie
                locavore, accusamus mcsweeney's marfa nulla single-origin coffee squid. Exercitation +1 labore velit,
                blog sartorial PBR leggings next level wes anderson artisan four loko farm-to-table craft beer twee.
                Qui photo booth letterpress, commodo enim craft beer mlkshk aliquip jean shorts ullamco ad vinyl cillum
                PBR. Homo nostrud organic, assumenda labore aesthetic magna delectus mollit. Keytar helvetica VHS
                salvia yr, vero magna velit sapiente labore stumptown. Vegan fanny pack odio cillum wes anderson 8-bit,
                sustainable jean shorts beard ut DIY ethical culpa terry richardson biodiesel. Art party scenester
                stumptown, tumblr butcher vero sint qui sapiente accusamus tattooed echo park.
            </div>
            <div class="tab-pane fade" id="files" role="tabpanel" aria-labelledby="files-tab">
                <div class="list-group-flush">
                    @{ 
                        foreach (var item in files)
                        {
                            <a href=@item.Path  class="list-group-item list-group-item-action">@item.Path</a>
                        }
                    }
                </div>
            </div>
        </div>
        <!-- einde section media -->
        @if (isAuth && user.IsRegistered(session.SessionId))
        {
            //nog checken of het event in het verleden ligt
            //nog checken of user al feedback gegeven heeft op dit event
            //TODO: needs more markup
            <div class="card mt-md-2 border-0">
                <form asp-controller="Session" asp-action="AddFeedback" method="post">
                    <div class="form-group">
                        <input type="hidden" name="id" value="@session.SessionId" />
                    </div>
                    <div class="form-group">
                        <label asp-for="Score">Score</label>
                        <span asp-validation-for="Score" class="text-danger"></span>
                        <select class="form-control" name="Score" asp-for="Score">
                            <option>1</option>
                            <option>2</option>
                            <option>3</option>
                            <option>4</option>
                            <option>5</option>
                        </select>
                    </div>
                    <div class="md-form">
                        <label asp-for="Description">Feedback</label>
                        <textarea asp-for="Description" class="md-textarea form-control" type="text" name="Description" placeholder="Schrijf je feedback..."></textarea>
                        <span asp-validation-for="Description" class="text-danger"></span>
                    </div>
                    <button type="submit" class="btn-primary">Verzend!</button>
                </form>
            </div>
        }
        @if (session.Feedback.Any())
        {
            <h3>Comments: </h3>
            <ul class="list-group-flush mb-9">
                @foreach (var feedback in session.Feedback)
                {
                    <li class="list-group-item">
                        <div class="row">
                            <div class="col-md-2">@feedback.Score / 5</div>
                            <div class="col-md-10">
                                <p class="text-body">
                                    @feedback.Description
                                </p>
                            </div>
                        </div>
                    </li>
                }
            </ul>
        }
    </div>
    <div class="col-sm-3">
        <div class="card">
            <h5 class="card-header">
                Locatie: @session.Location.Campus @session.Location.LocationId
            </h5>
            <div class="card-body">
                <p class="card-text">
                    Tijdstip: @session.GetDateFormat() @session.GetTimeFormat()
                </p>
            </div>
            <div class="card-footer">
                Verantwoordelijke: @session.Responsible.FirstName @session.Responsible.LastName
            </div>
        </div> <span class="badge badge-default">@session.UserSessions.Count() / @session.Capacity</span>
        <div class="progress">
            <div class="progress-bar" aria-valuenow=@session.GetUsers().Count() aria-valuemin="0"
                 aria-valuemax=@session.Capacity></div>
        </div>
        @if (isAuth)
        {
            if (user.IsRegistered(session.SessionId))
            {
                <form asp-controller="Session" asp-action="Delete" asp-route-id="@session.SessionId">
                    <button type="submit" class="btn btn-danger">
                        Uitschrijven
                    </button>
                </form>
            }
            else
            {
                if (session.GetUsers().Count() < session.Capacity)
                {
                    <form asp-controller="Session" asp-action="Add" asp-route-id="@session.SessionId">
                        <button type="submit" class="btn btn-success">
                            Inschrijven
                        </button>
                    </form>
                }
                else
                {
                    <form>
                        <button type="submit" class="btn btn-warning">
                            Volzet!
                        </button>
                    </form>
                }
            }
        }


    </div>
</div>

@section scripts {
    <script src="~/lib/jquery-validation/dist/jquery.validate.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>
} 